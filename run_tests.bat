@echo off
REM –°–∫—Ä–∏–ø—Ç –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –≤ Windows
REM –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: run_tests.bat [–æ–ø—Ü–∏–∏]

echo ========================================
echo üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ò–ô –ó–ê–ü–£–°–ö –¢–ï–°–¢–û–í
echo ========================================

REM –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è pytest
python -m pytest --version >nul 2>&1
if errorlevel 1 (
    echo [ERROR] pytest –Ω–µ –Ω–∞–π–¥–µ–Ω. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ: pip install pytest
    exit /b 1
)
echo [SUCCESS] pytest –Ω–∞–π–¥–µ–Ω

REM –û–±—Ä–∞–±–æ—Ç–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
if "%1"=="-k" (
    if "%2"=="" (
        echo [ERROR] –ù–µ —É–∫–∞–∑–∞–Ω –ø–∞—Ç—Ç–µ—Ä–Ω –¥–ª—è —Ç–µ—Å—Ç–æ–≤
        exit /b 1
    )
    echo [INFO] –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º: %2
    python -m pytest tests/ -v --tb=short -k "%2"
    goto :check_result
)

if "%1"=="-f" (
    if "%2"=="" (
        echo [ERROR] –ù–µ —É–∫–∞–∑–∞–Ω —Ñ–∞–π–ª —Å —Ç–µ—Å—Ç–∞–º–∏
        exit /b 1
    )
    echo [INFO] –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤ –∏–∑ —Ñ–∞–π–ª–∞: %2
    python -m pytest "%2" -v --tb=short
    goto :check_result
)

if "%1"=="-h" (
    echo –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: run_tests.bat [–æ–ø—Ü–∏–∏]
    echo.
    echo –û–ø—Ü–∏–∏:
    echo   -k PATTERN  –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å —É–∫–∞–∑–∞–Ω–Ω—ã–º –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º
    echo   -f FILE     –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏–∑ —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ñ–∞–π–ª–∞
    echo   -h          –ü–æ–∫–∞–∑–∞—Ç—å —ç—Ç—É —Å–ø—Ä–∞–≤–∫—É
    echo.
    echo –ü—Ä–∏–º–µ—Ä—ã:
    echo   run_tests.bat           –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ —Ç–µ—Å—Ç—ã
    echo   run_tests.bat -k modelid  –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã —Å –ø–∞—Ç—Ç–µ—Ä–Ω–æ–º 'modelid'
    echo   run_tests.bat -f tests\test_main.py  –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã –∏–∑ —Ñ–∞–π–ª–∞
    exit /b 0
)

REM –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
echo [INFO] –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Ç–µ—Å—Ç–æ–≤...
python -m pytest tests/ -v --tb=short

:check_result
if errorlevel 1 (
    echo.
    echo [ERROR] –¢–µ—Å—Ç—ã –Ω–µ –ø—Ä–æ—à–ª–∏!
    exit /b 1
) else (
    echo.
    echo [SUCCESS] –í—Å–µ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏ —É—Å–ø–µ—à–Ω–æ!
    exit /b 0
)