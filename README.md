# Интеграционный веб-интерфейс для системы "Товар-Деньги-Товар"

Расширяет функционал базовой системы, добавляя:
- REST API для управления расширенными описаниями товаров
- Микросервис для загрузки и обработки изображений
- Интеграцию с внешними системами учета
- Расширенную аналитику продаж

❗ Внимание! Рекомендации по безопасности:
- Используйте исключительно в защищенных/закрытых сетях
- Требуется дополнительная настройка аутентификации для production
- Ограничьте доступ к API через firewall
- Регулярно обновляйте секретные ключи

## Требования
- Python 3.8.9 (рекомендуется для Windows)  
  Скачать: [python-3.8.9.exe](https://www.python.org/ftp/python/3.8.9/python-3.8.9.exe)  
  Все версии: [python.org/downloads/windows/](https://www.python.org/downloads/windows/)
- Firebird Database
- Установленные зависимости из requirements.txt

## Установка
1. Скопируйте .env.example в .env:
   ```bash
   cp .env.example .env
   ```
2. Настройте параметры подключения в .env
3. Установите зависимости:
   ```bash
   pip install -r requirements.txt
   ```

## Переменные окружения (.env)
- `DATABASE_URL` - URL подключения к Firebird
- `DEBUG` - Режим отладки (True/False)
- `SECRET_KEY` - Секретный ключ приложения
- `IMG_STORAGE_PATH` - Путь для хранения изображений

## Запуск
```bash
uvicorn app.main:app --reload
```

## Примеры API

### Работа с изображениями товаров

#### Загрузка изображения
```
POST /api/modelgoods/image/
```
Параметры формы:
- `modelid` (обязательный) - ID товара
- `file` (обязательный) - файл изображения

Ответ:
```json
{
  "status": "success",
  "filename": "00000000000001_00000000000002.jpg",
  "message": null
}
```

#### Получение информации об изображении
```
GET /api/modelgoods/image/{modelid}
```
Параметры пути:
- `modelid` - ID товара

Ответ:
```json
{
  "modelid": "00000000000001",
  "filename": "00000000000001_00000000000002.jpg",
  "imgext": "jpg",
  "changedate": "2026-02-12 19:30:45"
}
```

#### Удаление изображения
```
DELETE /api/modelgoods/image/{modelid}
```
Параметры пути:
- `modelid` - ID товара

Ответ:
```json
{
  "status": "success",
  "message": "Image deleted successfully"
}
```

### Другие API
- Получение последних 50 товаров без описаний в файле: `GET /api/products/`
- Проверка здоровья системы: `GET /healthcheck`
- Сохранение параметров товара: `POST /api/modelgoods/parameters/{model_id}`
- Получение параметров товара: `GET /api/modelgoods/parameters/{model_id}`
- Получение инвентаря с фильтром по трейлерам: `GET /` (исключает Folders.istrailer=1)

## Новые функции

### Управление изображениями товаров
- **Полнофункциональный API** для работы с изображениями товаров:
  - Загрузка изображений через `POST /api/modelgoods/image/`
  - Получение информации об изображении через `GET /api/modelgoods/image/{modelid}`
  - Удаление изображений через `DELETE /api/modelgoods/image/{modelid}`
- **Интеграция с базой данных**: автоматическое обновление поля `imgext` в таблице `modelgoods`
- **Безопасное хранение**: использование хранимых процедур Firebird для работы с файлами
- **Обработка ошибок**: корректная обработка отсутствующих товаров и файлов

### Улучшения интерфейса
- Добавлен фильтр трейлеров в основном интерфейсе инвентаря
- Реализована пагинация с учетом фильтрации по трейлерам

### Тестирование
- Добавлены тесты для API работы с изображениями (`tests/test_modelgoods_images.py`)
- Проверка структуры API и обработки ошибок

## Тестирование
```bash
pytest tests/
